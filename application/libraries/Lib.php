<?phpclass Lib_Core{	public function __construct(){	}	public static function config($key, $array_key = NULL, $sub_array_key = NULL){		if($array_key !== NULL):			$conf = Kohana::config($key);			if(is_array($conf)):				if(isset($conf[$array_key])):					if(isset($sub_array_key) and is_array($conf[$array_key])):						if(isset($conf[$array_key][$sub_array_key])):							return $conf[$array_key][$sub_array_key];						endif;						return '';					endif;					return $conf[$array_key];				endif;				return '';			endif;			return $conf;		else:			return Kohana::config($key);		endif;	}	public function pagenotfound(){		return Event::run('system.404');	}	public function log($message, $mode = 'error') {		return Kohana::log($mode, $message);	}	/**	 * Отправка письма от авторизационной системы пользователю	 *	 * @param string $subject  - тема письма	 * @param string $tpl_name - имя шаблона	 * @param array $tpl_data  - массив с данными для шаблона     * @param array $attachments - массив файлов, которые надо прикрепить к письму	 */	public static function sendEmail($subject, $tpl, $data, $attachments = array()) {		require 'system/vendor/phpmailer/phpmailer/PHPMailerAutoload.php';		$mail = new PHPMailer;		$mail->isSMTP();		$mail->CharSet = 'UTF-8';		$mail->Host = 'smtp.yandex.ru';		$mail->SMTPAuth = true;                               // Enable SMTP authentication		$mail->Username = 'contact@ali-baba.uz';                 // SMTP username		$mail->Password = 'Cb8Vi6y89wCZfP6u';                           // SMTP password		$mail->SMTPSecure = 'tls';		$mail->Port = 587;		$mail->isHTML(true);		if(is_string($tpl)) $tpl = View::factory($tpl, $data);		$body = $tpl->render();		$recipient = $data['email'];		if(empty($data['sender'])):			$sender = array(				0 => Lib::config('app.email_address_from'),				1 => Lib::config('app.email_name_from'),			);		else:			$sender = $data['sender'];		endif;		if(Lib::config('app.email_subject_prefix') != '') $subject = Lib::config('app.email_subject_prefix').$subject;		try{			$mail->setFrom('contact@ali-baba.uz', 'AliBaba');			$mail->addReplyTo($sender[0], $sender[1]);			$mail->addAddress($recipient);			$mail->Subject = $subject;			$mail->Body    = $body;			//$mail->AltBody = $body;			if(!$mail->send()) {				self::log('Не отправляется письмо: '.$subject.'!'."\n".$mail->ErrorInfo);			} else {				 return true;			}            //return @email::send($recipient, $sender, '=?utf-8?B?' . base64_encode($subject).'?=', $body, $html = false, $attachments);		} catch (Exception $e) {			self::log('Не отправляется письмо: '.$subject.'!'."\n".$e->getMessage());		}		return false;	}}