var objString=[];objString.title="Объявление";objString.disabled=objString.title+" отключено.";objString.no_deleted="У Вас нет удалённых объявлений.";objString.continued="Показ объявления продлён!";objString.deleted=objString.title+" удалено!";objString.noobjects="У Вас нет объявлений.";objString.blocked=objString.title+" заблокировано!";objURL=objFEURL="/offer/";$(function(){function d(){var j=$(this);j.addClass("busy");$.getJSON(j.attr("href"),function(k){if(k.errors==null){j.removeClass("busy");switch(j.attr("className")){case"enable":$(".obj_disabled").remove();$(".enable",".owner, .moderator").addClass("dn").next().removeClass("dn");if(k.data.date!=null){$("#expires").html("Актуально: <span>до "+k.data.date+"</span>")}break;case"disable":$(".disable",".owner, .moderator").addClass("dn").prev().removeClass("dn");$(".lcol").prepend('<div class="obj_status obj_disabled bcorns"><i class="ct"><i></i><b></b></i><h5>'+objString.disabled+'</h5><i class="cb"><i></i><b></b></i></div>');break;case"unban":$(".obj_banned").remove();$(".unban",".moderator").addClass("dn");$(".ban",".moderator").removeClass("dn");break;case"remove_complaint":if(k.data.id!=null){$("#complaint"+k.data.id,".complaints").remove()}if(k.data.all!=null||$(".item",".complaints").length==0){$(".complaints").remove()}break;case"position":$(".position",".moderator_actions").html("<b>Поднято</b>");break;case"mark":$(".mark",".moderator_actions").addClass("dn");$(".unmark",".moderator_actions").removeClass("dn");if(k.data.date!=null){$("#marked_till").html(' | <b class="ora">Выделено:</b> <i>до '+k.data.date+"</i>")}break;case"unmark":$(".unmark",".moderator_actions").addClass("dn");$(".mark",".moderator_actions").removeClass("dn");$("#marked_till").html("");break;case"premium":$(".premium",".moderator_actions").addClass("dn");$(".unpremium",".moderator_actions").removeClass("dn");if(k.data.date!=null){$("#premium_till").html(' | <b class="ora">Премиум:</b> <i>до '+k.data.date+"</i>")}break;case"unpremium":$(".unpremium",".moderator_actions").addClass("dn");$(".premium",".moderator_actions").removeClass("dn");$("#premium_till").html("");break}if($(".editlist").length!=0){line=j.parents(".ofr");switch(j.attr("className")){case"list_enable":line.removeClass("disabled").addClass("enabled");html="<i>Актуально до</i> ";if(k.data.date!=null){html+="<p>"+k.data.date;html+="</p>"}$(".s i",line).next().remove();$(".s i",line).replaceWith(html);$(".pay, .list_disable, .list_expiration",line).removeClass("dn").show();$("#count_enabled").text($("#count_enabled").text()*1+1);if($("#count_disabled").text()*1){$("#count_disabled").text($("#count_disabled").text()*1-1)}j.hide();break;case"list_unban":line.removeClass("banned").addClass(k.data.status);html="<i>"+k.data.status_title+"</i> ";if(k.data.status=="enabled"&&k.data.date!=null){html+="<p>";html+=k.data.date;html+="</p>"}$(".s i",line).next().remove();$(".s i",line).replaceWith(html);$(".pay, .list_disable, .list_ban",line).removeClass("dn").show();j.hide();break;case"list_disable":line.removeClass("enabled").addClass("disabled");html="<b>Неактивно</b><p>&nbsp;</p>";$(".s i",line).html(html).next().remove();$("#count_disabled").text($("#count_disabled").text()*1+1);if($("#count_disabled").text()*1){$("#count_enabled").text($("#count_enabled").text()*1-1)}$(".list_enable",line).removeClass("dn").show();$(".pay, .list_expiration",line).hide();j.hide();break;case"list_undelete":line.remove();if($("#count_deleted").text()*1){$("#count_deleted").text($("#count_deleted").text()*1-1)}$("#count_total").text($("#count_total").text()*1+1);if(k.data.status!=null){$("#count_"+k.data.status).text($("#count_"+k.data.status).text()*1+1)}if($(".editlist tbody").children().length==0){$(".editlist").replaceWith("<p>"+objString.no_deleted+"</p>")}break;case"list_position":line.addClass("positioned");j.html("<b>Поднято</b>");$(".mo",line).html("Поднято");$(".m b",line).addClass("e");break;case"list_mark":line.addClass("or marked");$(".list_mark, .list_unmark",line).toggle().removeClass("dn");$(".mo",line).html("Выделено");$(".m i",line).addClass("e");break;case"list_unmark":line.removeClass("or marked");$(".list_mark, .list_unmark",line).toggle().removeClass("dn");$(".mo",line).html(line.hasClass("positioned")?"Поднято":"Обычное");$(".m i.e",line).removeClass("e");break;case"list_premium":line.addClass("premium");$(".list_premium, .list_unpremium",line).toggle().removeClass("dn");$(".mo",line).html("Премиум");$(".m u",line).addClass("e");break;case"list_unpremium":line.removeClass("premium");$(".list_premium, .list_unpremium",line).toggle().removeClass("dn");$(".mo",line).html(line.hasClass("positioned")?"Поднято":"Обычное");$(".m u.e",line).removeClass("e");break}}}});return false}$(".obj_status h5 a").click(d);$(".remove_complaint",".complaints").click(d);$(".owner, .moderator").hover(DDM_open,DDM_timer);$(".enable, .disable, .unban, .premium, .unpremium, .mark, .unmark, .position",".owner, .moderator_actions").click(d);if($(".editlist").length!=0){$(".list_enable, .list_disable, .list_unban, .list_undelete, .list_mark, .list_unmark, .list_premium, .list_unpremium, .list_position",".editlist").click(d)}function b(){var j=$(this);j.hide().after('<span class="loading">Подождите...</span>');$.getJSON(j.attr("href"),function(k){if(k.errors==null){j.next().remove();j.replaceWith('<span class="bookmark">В закладках</span>');if($("SPAN",".mybookmarks").length==0){$(".mybookmarks").append(" (<span>1</span>)")}else{$("SPAN",".mybookmarks").text($("SPAN",".mybookmarks").text()*1+1)}}});return false}$("a.bookmarkit").click(b);function f(){modalPosition();$(".image").css("max-height",(modalPosition()-139)+"px");$("img","#image_view").unbind("load")}function c(){img=$("img","#image_view");$("#image_list a").click(function(){lnk=this;imgAttr=lnk.name.split("|");img.attr("src","/assets/img/dot.gif");if(imgAttr[1]){img.attr("width",imgAttr[1])}else{img.removeAttr("width")}if(imgAttr[2]){img.attr("height",imgAttr[2])}else{img.removeAttr("height")}setTimeout(function(){$(".image").css("max-height","");img.unbind("load").load(f);img.attr("src",imgAttr[0])},10);img.next(".image_title").text(lnk.title);img.attr("title",lnk.title).attr("alt",lnk.title);return false});img.one("load",f)}c();function h(k){replacement='<div class="success">';if($("#message_form").hasClass("expiration_form")){replacement+="<h3>"+objString.continued+"</h3>";if($(".editlist").length==0){if(k.data.date!=null){$("#expires").html("Актуально до: <b>"+k.data.date+"</b>")}$(".obj_expired").remove()}else{if(k.data.id!=null){if(k.data.status!=null&&k.data.status=="enabled"){line=$("#o"+k.data.id);stat=$(".s i",line);if(line.hasClass("expired")){$("#count_enabled").text($("#count_enabled").text()*1+1);$("#count_disabled").text($("#count_disabled").text()*1-1);line.removeClass("expired").addClass("enabled");$(".pay",line).removeClass("dn").show()}stat.html("Актуально до");if(k.data.date!=null){html="<p>";html+=k.data.date;html+="</p>";stat.next().remove();stat.after(html)}}}}}else{if($("#message_form").hasClass("delete_form")){replacement+="<h3>"+objString.deleted+"</h3>";if($(".editlist").length==0){setTimeout(function(){location.href="/"},2000)}else{if(k.data.id!=null){$("#o"+k.data.id).remove()}if($(".ofr",".editlist").length==0){$(".editlist").remove();$(".nolistitems").show()}$("#count_deleted").text($("#count_deleted").text()*1+1);if($("#count_total").text()*1){$("#count_total").text($("#count_total").text()*1-1)}if($("#count_enabled").text()*1){$("#count_enabled").text($("#count_enabled").text()*1-1)}if($("#count_disabled").text()*1){$("#count_disabled").text($("#count_disabled").text()*1-1)}}}else{if($("#message_form").hasClass("ban_form")){replacement+="<h3>"+objString.blocked+"</h3>";if($(".editlist").length==0){$(".ban",".moderator").addClass("dn");$(".unban",".moderator").removeClass("dn");var j='<div class="obj_status obj_banned bcorns"><i class="ct"><i></i><b></b></i><h5>'+objString.blocked+"</h5>";if($(':input[name="content"]',$("#message_form")).val()!=""){j+="<p>Причина: "+$(':input[name="content"]',$("#message_form")).val()+"</p>"}j+='<i class="cb"><i></i><b></b></i></div>';$(".lcol").prepend(j)}else{if(k.data.id!=null){line=$("#o"+k.data.id);line.removeClass(k.data.prev_status).addClass("banned");html="<i>Заблокировано</i> ";$(".s i",line).next().remove();$(".s i",line).replaceWith(html);$(".pay, .list_disable",line).hide();$(".list_ban, .list_unban",line).toggle().removeClass("dn")}}}else{if($("#message_form").hasClass("bookmark_delete_form")){replacement+="<h3>Закладка удалена!</h3>";if(k.data.id!=null){$("#o"+k.data.id).remove()}if($(".editlist").length==0){setTimeout(function(){location.href="/"},2000)}else{if(k.data.id!=null){if(k.data.id!=null){$("#o"+k.data.id).remove()}}}if($(".ofr",".editlist").length==0){$(".editlist").remove();$(".nolistitems").show()}if($("SPAN",".mybookmarks").length!=0){$("SPAN",".mybookmarks").text($("SPAN",".mybookmarks").text()*1-1)}}else{replacement+="<h3>Ваше сообщение успешно отправлено!</h3>"}}}}replacement+='<div class="note">Это окно автоматически закроется через несколько секунд. <a href="#" onclick="$(\'.jqmClose\').click(); return false">Закрыть сейчас.</a></div></div>';$("#message_form").replaceWith(replacement);setTimeout(function(){$(".jqmClose").click()},3000);return false}function i(j){if(showErrors(j.errors,$(".mess",$("#message_form")))){refreshCaptcha();$('input[type="submit"]',$("#message_form")).removeAttr("disabled")}else{if(a.mode=="modal"){h(j)}else{$("#ajaxstatus").html("Пожалуйста подождите...").show();if(j.redirect!=null){location.href=j.redirect}else{lnk=objURL+$('input[name="obj_id"]',$("#message_form")).val();if($("#message_form").hasClass("expiration_form")){lnk+="/expiration_success/"}else{if($("#message_form").hasClass("remove_form")){lnk=objURL+"delete_success/"}else{lnk+="/message_success/"}}location.href=lnk}}}}function g(j){a.mode="modal";$("form",j.w).ajaxForm(a);modifySymbolsleft();modifyCaptcha();modifyAjaxStatus();$('input[name="cancel"]',$("#message_form")).addClass("jqmClose");modalPosition();e();c()}function e(){if($("#predefined_reason").length){$("#predefined_reason").change(function(){if(this.value=="other"){$("#reason_content").removeAttr("disabled").focus()}else{$("#reason_content").attr("disabled","disabled")}})}}var a=$.extend({},ajaxOptions||{},{mode:"page",success:i,beforeSubmit:function(){$('input[type="submit"]',$("#message_form")).attr("disabled","disabled")}});e();$("#message_form").ajaxForm(a);if($("#modalBox").length){$("#modalBox").jqm($.extend({ajax:"@href",onLoad:g},modalOptions||{}))}$('input[name="cancel"]',$("#message_form")).click(function(){location.href="/offer/"+$('input[name="offer_id"]',$("#message_form")).val()})});