var objString = [];objString['title'] = 'Объявление';objString['disabled'] = objString['title'] + ' отключено.';objString['no_deleted'] = 'У Вас нет удалённых объявлений.';objString['continued'] = 'Показ объявления продлён!';objString['premiumed'] = 'Объявление премировано!';objString['marked'] = 'Объявление выделено!';objString['positioned'] = 'Объявление поднято!';objString['deleted'] = objString['title'] + ' удалено!';objString['noobjects'] = 'У Вас нет объявлений.';objString['blocked'] = objString['title'] + ' заблокировано!';objURL = objFEURL = '/offer/';$(function() {/** * CONTEXT MENU */	function simpleAction(){		var lnk = $(this);		lnk.addClass('busy');		$.getJSON(lnk.attr('href'), function(json){			if(json.errors == null){				lnk.removeClass('busy');				switch(lnk.attr('className')){					case 'enable':						$('.obj_disabled').remove();						$('.enable','.owner, .moderator').addClass('dn').next().removeClass('dn');						if(json.data.date != null) $('#expires').html('Актуально: <span>до '+json.data.date+'</span>');					break;					case 'disable':						$('.disable','.owner, .moderator').addClass('dn').prev().removeClass('dn');						$('.lcol').prepend('<div class="obj_status obj_disabled bcorns"><i class="ct"><i></i><b></b></i><h5>' +objString['disabled'] + '</h5><i class="cb"><i></i><b></b></i></div>');					break;					case 'unban':						$('.obj_banned').remove();						$('.unban','.moderator').addClass('dn');						$('.ban','.moderator').removeClass('dn');					break;					case 'remove_complaint':						if(json.data.id != null) $('#complaint'+json.data.id, '.complaints').remove();						if(json.data.all != null || $('.item', '.complaints').length == 0) $('.complaints').remove();					break;					case 'position':						$('.position','.moderator_actions').html('<b>Поднято</b>');					break;/*					case 'mark':						$('.mark','.moderator_actions').addClass('dn');						$('.unmark','.moderator_actions').removeClass('dn');						if(json.data.date != null) $('#marked_till').html(' | <b class="ora">Выделено:</b> <i>до '+json.data.date+'</i>');					break;*/					case 'unmark':						$('.unmark','.moderator_actions').addClass('dn');						$('.mark','.moderator_actions').removeClass('dn');						$('#marked_till').html('');					break;/*					case 'premium':						$('.premium','.moderator_actions').addClass('dn');						$('.unpremium','.moderator_actions').removeClass('dn');						if(json.data.date != null) $('#premium_till').html(' | <b class="ora">Премиум:</b> <i>до '+json.data.date+'</i>');					break;*/					case 'unpremium':						$('.unpremium','.moderator_actions').addClass('dn');						$('.premium','.moderator_actions').removeClass('dn');						$('#premium_till').html('');					break;				}				if($('.editlist').length != 0){					line = lnk.parents('.ofr');					switch(lnk.attr('className')){						case 'list_enable':							line.removeClass('disabled').addClass('enabled');							html = '<i>Актуально до</i> ';							if(json.data.date != null){								html += '<p>' + json.data.date;								html += '</p>';							}							$('.s i', line).next().remove();							$('.s i', line).replaceWith(html);							$('.pay, .list_disable, .list_expiration', line).removeClass('dn').show();							$('#count_enabled').text($('#count_enabled').text()*1+1);							if($('#count_disabled').text()*1) $('#count_disabled').text($('#count_disabled').text()*1-1);							lnk.hide();						break;						case 'list_unban':							line.removeClass('banned').addClass(json.data.status);							html = '<i>'+json.data.status_title+'</i> ';							if(json.data.status == 'enabled' && json.data.date != null){								html += '<p>';								html += json.data.date;								html += '</p>';							}							$('.s i', line).next().remove();							$('.s i', line).replaceWith(html);							$('.pay, .list_disable, .list_ban', line).removeClass('dn').show();							lnk.hide();						break;						case 'list_disable':							line.removeClass('enabled').addClass('disabled');							html = '<b>Неактивно</b><p>&nbsp;</p>';							$('.s i', line).html(html).next().remove();							$('#count_disabled').text($('#count_disabled').text()*1+1);							if($('#count_disabled').text()*1) $('#count_enabled').text($('#count_enabled').text()*1-1);							$('.list_enable', line).removeClass('dn').show();							$('.pay, .list_expiration', line).hide();							lnk.hide();						break;						case 'list_undelete':							line.remove();							if($('#count_deleted').text()*1) $('#count_deleted').text($('#count_deleted').text()*1-1);							$('#count_total').text($('#count_total').text()*1+1);							if(json.data.status != null){								$('#count_'+json.data.status).text($('#count_'+json.data.status).text()*1+1);							}							if($('.editlist tbody').children().length == 0){								$('.editlist').replaceWith('<p>' +objString['no_deleted']+ '</p>');							}						break;						case 'list_position':							line.addClass('positioned');							lnk.html('<b>Поднято</b>');							$('.mo', line).html('Поднято');							$('.m b', line).addClass('e');						break;/*						case 'list_mark':							line.addClass('or marked');							$('.list_mark, .list_unmark', line).toggle().removeClass('dn');							$('.mo', line).html('Выделено');							$('.m i', line).addClass('e');*/						break;						case 'list_unmark':							line.removeClass('or marked');							$('.list_mark, .list_unmark', line).toggle().removeClass('dn');							$('.mo', line).html(line.hasClass('positioned')?'Поднято':'Обычное');							$('.m i.e', line).removeClass('e');						break;/*						case 'list_premium':							line.addClass('premium');							$('.list_premium, .list_unpremium', line).toggle().removeClass('dn');							$('.mo', line).html('Премиум');							$('.m u', line).addClass('e');						break;*/						case 'list_unpremium':							line.removeClass('premium');							$('.list_premium, .list_unpremium', line).toggle().removeClass('dn');							$('.mo', line).html(line.hasClass('positioned')?'Поднято':'Обычное');							$('.m u.e', line).removeClass('e');						break;					}				}			}            else{                lnk.removeClass('busy');                showErrors(json.errors, $('.mess', $('#message_form')));            }		});		return false;	};/* STATUS MESSAGES */	$('.obj_status h5 a').click(simpleAction);	$('.remove_complaint','.complaints').click(simpleAction);/** * MENU */	$('.owner, .moderator').hover(DDM_open, DDM_timer);	$('.enable, .disable, .unban, .premium, .unpremium, .mark, .unmark, .position','.owner, .moderator_actions').click(simpleAction);	if($('.editlist').length != 0){		$('.list_enable, .list_disable, .list_unban, .list_undelete, .list_mark, .list_unmark, .list_premium, .list_unpremium, .list_position','.editlist').click(simpleAction);	}/** * BOOKMARK */  function bookmarkIt(){	var lnk = $(this);	lnk.hide().after('<span class="loading">Подождите...</span>');	$.getJSON(lnk.attr('href'), function(json){		if(json.errors == null){			lnk.next().remove();			lnk.replaceWith('<span class="bookmark">В закладках</span>');			if($('SPAN', '.mybookmarks').length == 0){				$('.mybookmarks').append(' (<span>1</span>)');			}else{				$('SPAN', '.mybookmarks').text($('SPAN', '.mybookmarks').text()*1+1);			}		}	});	return false;  };  $('a.bookmarkit').click(bookmarkIt);/** * IMAGES */	function imagePosition(){		modalPosition();		$('.image').css('max-height',(modalPosition() - 139)+'px');		$('img','#image_view').unbind('load');	};	function initImages(){		img = $('img','#image_view');		$('#image_list a').click(function(){			lnk = this;			imgAttr = lnk.name.split('|');			img.attr('src', '/assets/img/dot.gif');			if(imgAttr[1]) img.attr('width', imgAttr[1]);			else  img.removeAttr('width');			if(imgAttr[2]) img.attr('height', imgAttr[2]);			else  img.removeAttr('height');			setTimeout(function(){				$('.image').css('max-height','');				img.unbind('load').load(imagePosition);				img.attr('src', imgAttr[0]);			}, 10);			img.next('.image_title').text(lnk.title);			img.attr('title', lnk.title).attr('alt',lnk.title)			return false;		});		img.one('load',imagePosition);   };   initImages();/** * MESSAGES AND ETC */	function messageSuccess(json){		replacement = '<div class="success">';// expiration		if($('#message_form').hasClass('expiration_form')){			replacement += '<h3>' +objString['continued']+ '</h3>';			if($('.editlist').length == 0){				if(json.data.date != null) $('#expires').html('Актуально до: <b>'+json.data.date+'</b>');				$('.obj_expired').remove();			}else if(json.data.id != null){				if(json.data.status != null && json.data.status == 'enabled'){					line = $('#o' + json.data.id);					stat = $('.s i', line);					if(line.hasClass('expired')){						$('#count_enabled').text($('#count_enabled').text()*1+1);						$('#count_disabled').text($('#count_disabled').text()*1-1);						line.removeClass('expired').addClass('enabled');						$('.pay', line).removeClass('dn').show();					}					stat.html('Актуально до');					if(json.data.date != null){						html = '<p>';						html += json.data.date;						html += '</p>';						stat.next().remove();						stat.after(html);					}				}			}// premium		}else if($('#message_form').hasClass('premium_form')){			replacement += '<h3>' +objString['premiumed']+ '</h3>';			if($('.editlist').length == 0){				line = $('#o' + json.data.id);				line.addClass('premium');				$('.m u', line).addClass('e');				//$('.premium','.moderator_actions').addClass('dn');				//$('.premium', '.owner_actions').addClass('dn');				if (json.data.bonus_amount) $('.mybonuses span','.menubar').text(json.data.bonus_amount);				//$('.unpremium','.moderator_actions').removeClass('dn');				if(json.data.date != null) $('#premium_till').html(' | <b class="ora">Премиум:</b> <i>до '+json.data.date+'</i>');			}else if(json.data.id != null){				line = $('#o' + json.data.id);				line.addClass('premium');				//$('.premium', '.actions').addClass('dn');				if (json.data.bonus_amount) $('.mybonuses span','.menubar').text(json.data.bonus_amount);				//$('.list_premium, .list_unpremium', line).toggle().removeClass('dn');				$('.mo', line).html('Премиум');				$('.m u', line).addClass('e');				if(json.data.date != null) $('#premium_till').html(' | <b class="ora">Премиум:</b> <i>до '+json.data.date+'</i>');			}// mark		}else if($('#message_form').hasClass('mark_form')){			replacement += '<h3>' +objString['marked']+ '</h3>';			if($('.editlist').length == 0){				line = $('#o' + json.data.id);				line.addClass('premium');				$('.m i', line).addClass('e');				//$('.mark','.moderator_actions').addClass('dn');				//$('.mark', '.owner_actions').addClass('dn');				if (json.data.bonus_amount) $('.mybonuses span','.menubar').text(json.data.bonus_amount);				//$('.unmark','.moderator_actions').removeClass('dn');				if(json.data.date != null) $('#marked_till').html(' | <b class="ora">Выделено:</b> <i>до '+json.data.date+'</i>');			}else if(json.data.id != null){				line = $('#o' + json.data.id);				line.addClass('or marked');				//$('.mark', '.actions').addClass('dn');				if (json.data.bonus_amount) $('.mybonuses span','.menubar').text(json.data.bonus_amount);				//$('.list_mark, .list_unmark', line).toggle().removeClass('dn');				$('.mo', line).html('Выделено');				$('.m i', line).addClass('e');				if(json.data.date != null) $('#marked_till').html(' | <b class="ora">Выделено:</b> <i>до '+json.data.date+'</i>');			}// position		}else if($('#message_form').hasClass('position_form')){			replacement += '<h3>' +objString['positioned']+ '</h3>';			if (json.data.bonus_amount) $('.mybonuses span','.menubar').text(json.data.bonus_amount);			if(json.data.id != null){				line = $('#o' + json.data.id);				line.addClass('or positioned');				$('.list_position', line).toggle().removeClass('dn');				$('.mo', line).html('Поднято');				$('.m b', line).addClass('e');			}// delete		}else if($('#message_form').hasClass('delete_form')){			replacement += '<h3>' +objString['deleted']+ '</h3>';			if($('.editlist').length == 0){				setTimeout(function(){location.href='/'}, 2000);			}else{				if(json.data.id != null){					$('#o' + json.data.id).remove();				}				if($('.ofr', '.editlist').length == 0){					$('.editlist').remove();					$('.nolistitems').show();				}				$('#count_deleted').text($('#count_deleted').text()*1+1);				if($('#count_total').text()*1) $('#count_total').text($('#count_total').text()*1-1);				if($('#count_enabled').text()*1) $('#count_enabled').text($('#count_enabled').text()*1-1);				if($('#count_disabled').text()*1) $('#count_disabled').text($('#count_disabled').text()*1-1);			}// ban		}else if($('#message_form').hasClass('ban_form')){			replacement += '<h3>' +objString['blocked']+ '</h3>';			if($('.editlist').length == 0){				$('.ban','.moderator').addClass('dn');				$('.unban','.moderator').removeClass('dn');				var banmessage = '<div class="obj_status obj_banned bcorns"><i class="ct"><i></i><b></b></i><h5>' +objString['blocked']+ '</h5>';				if($(':input[name="content"]', $('#message_form')).val() !='')					banmessage += '<p>Причина: ' + $(':input[name="content"]', $('#message_form')).val() + '</p>';				banmessage += '<i class="cb"><i></i><b></b></i></div>';				$('.lcol').prepend(banmessage);			}else if(json.data.id != null){				line = $('#o' + json.data.id);				line.removeClass(json.data.prev_status).addClass('banned');				html = '<i>Заблокировано</i> ';				$('.s i', line).next().remove();				$('.s i', line).replaceWith(html);				$('.pay, .list_disable', line).hide();				$('.list_ban, .list_unban', line).toggle().removeClass('dn');			}// bookmark	delete		}else if($('#message_form').hasClass('bookmark_delete_form')){			replacement += '<h3>Закладка удалена!</h3>';			if(json.data.id != null) $('#o' + json.data.id).remove();			if($('.editlist').length == 0){				setTimeout(function(){location.href='/'}, 2000);			}else if(json.data.id != null){				if(json.data.id != null) $('#o' + json.data.id).remove();			}			if($('.ofr', '.editlist').length == 0){				$('.editlist').remove();				$('.nolistitems').show();			}			if($('SPAN', '.mybookmarks').length != 0)				$('SPAN', '.mybookmarks').text($('SPAN', '.mybookmarks').text()*1-1);		}else{			replacement += '<h3>Ваше сообщение успешно отправлено!</h3>';		}		replacement += '<div class="note">Это окно автоматически закроется через несколько секунд. '				+'<a href="#" onclick="$(\'.jqmClose\').click(); return false">Закрыть сейчас.</a></div>'				+'</div>';		$('#message_form').replaceWith(replacement);		modal_timeout = setTimeout(function(){$('.jqmClose').click()}, 3000);		return false;	}/** * MESSAGE SEND */	function messageFormHandle(json) {		if (showErrors(json.errors, $('.mess', $('#message_form')))) {			refreshCaptcha();			$('input[type="submit"]', $('#message_form')).removeAttr('disabled');		} else {			if(messageFormOptions.mode == 'modal'){				messageSuccess(json);			}else{				$('#ajaxstatus').html('Пожалуйста подождите...').show();				if(json.redirect != null){					location.href = json.redirect;				}else{					lnk = objURL+$('input[name="obj_id"]', $('#message_form')).val();					if($('#message_form').hasClass('expiration_form')){						lnk += '/expiration_success/';					}else if($('#message_form').hasClass('remove_form')){						lnk = objURL + 'delete_success/';					}else{						lnk += '/message_success/';					}					location.href=lnk;				}			}		}	}	function messageLoad(hash){		messageFormOptions.mode = 'modal';		$('form',hash.w).ajaxForm(messageFormOptions);		modifySymbolsleft();		modifyCaptcha();		modifyAjaxStatus();		$('input[name="cancel"]', $('#message_form')).addClass('jqmClose');		$('.jqmClose').click(function(){            $('.busy').removeClass('busy');            if (typeof(modal_timeout) != 'undefined') {                clearTimeout(modal_timeout);            }        });		modalPosition();		initReason();		initImages();		handleDaysChange();	};	function initReason(){		if($('#predefined_reason').length){			$('#predefined_reason').change(function(){				if(this.value == 'other') $('#reason_content').removeAttr('disabled').focus();				else $('#reason_content').attr('disabled','disabled');			});		};	};	var messageFormOptions = $.extend({}, ajaxOptions || {},	{		mode: 'page',		success: messageFormHandle,		beforeSubmit: function(){			$('input[type="submit"]', $('#message_form')).attr('disabled','disabled');		}	});	initReason();	$('#message_form').ajaxForm(messageFormOptions);// Initialization of modal	if($('#modalBox').length){		$('#modalBox').jqm($.extend({ajax: '@href', onLoad:messageLoad}, modalOptions || {}));	}	//$('textarea[name="content"]').keyup(symbolsLeft);	$('input[name="cancel"]', $('#message_form')).click(	  	function(){location.href='/offer/'+ $('input[name="offer_id"]', $('#message_form')).val()}	);	function handleDaysChange()	{		$('#count', $('#message_form')).change(function(){			var count = $('option:selected', $(this)).val();			count *= tariff;			$('b.ora', $('#message_form')).text(declension_numerals(count, 'бонус', 'бонуса', 'бонусов'));		});	}});