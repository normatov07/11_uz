$(function(){$("#qn_category").change(function(){if(this.value!=""){location.href="/cat/"+this.value}});$("#type_id").change(function(){if(this.options[this.selectedIndex].title==""||this.options[this.selectedIndex].title.substr(0,1)=="1"){$(".selectprice:hidden").show()}else{$(".selectprice:visible").hide()}});$("#type_id").change();if($("#region_id")[0]){region=new Array();current_region_id=$("#region_id").val();if($("#district_id")[0]){if(region[current_region_id]==null){region[current_region_id]=new Array()}region[current_region_id]["districts"]=new Array();region[current_region_id]["district_title"]=$("#district_title").html();region[current_region_id]["has_district"]=true;i=0;k=0;if(option=$("#district_id").attr("options")){while(i<option.length){if(option[i].value==""||option[i].value<0){i++;continue}region[current_region_id]["districts"][k]={id:option[i].value,title:option[i].text};i++;k++}}}if($("#subway_id")[0]){if(region[current_region_id]==null){region[current_region_id]=new Array()}region[current_region_id]["subways"]=new Array();region[current_region_id]["has_subway"]=true;i=0;k=0;if(option=$("#subway_id").attr("options")){while(i<option.length){if(option[i].value==""||option[i].value<0){i++;continue}region[current_region_id]["subways"][k]={id:option[i].value,title:option[i].text};i++;k++}}}$("#region_id").change(b)}function a(){cat={};cat.has_district=$("#region_id").hasClass("wdistrict")?1:0;cat.has_subway=$("#region_id").hasClass("wsubway")?1:0;return cat}function b(){region_id=$("#region_id").val();if(region_id!=""){cat=a();if(cat.has_district||cat.has_subway){districtObj=$("#district_id");subwayObj=$("#subway_id");if(current_region_id!=region_id||(cat.has_district&&!districtObj.length)||(cat.has_subway&&!subwayObj.length)){if(reg=c(region_id,cat.has_district,cat.has_subway)){if(cat.has_district&&reg.has_district!=null&&reg.districts!=null){list=reg.districts;html='<li class="selectdistrict">';html+="<label>"+reg.district_title+":</label>";html+=form_Select("district_id",list,"","не выбран");html+="</li>";if(districtObj.length){districtObj.parents("li").replaceWith(html)}else{$("ul",'form[name="filters"]').prepend(html)}}else{districtObj.parents("li").remove()}if(cat.has_subway&&reg.has_subway!=null&&reg.subways!=null){html='<li class="selectdistrict">';html+="<label>Станция метро:</label>";html+=form_Select("subway_id",reg.subways,"","не выбран");html+="</li>";if(subwayObj.length){subwayObj.parents("li").replaceWith(html)}else{if($("#district_id").length){$("#district_id").parents("li").after(html)}else{$("ul",'form[name="filters"]').prepend(html)}}}else{subwayObj.parents("li").remove()}return true}return true}}}current_region_id=region_id;$("#district_id").parents("li").remove();$("#subway_id").parents("li").remove()}function c(f,d,e){if(f==null){return false}if(region!=null&&region[f]!=null&&(d==null||region[f].has_district!=null)&&(e==null||region[f].has_subway!=null)){return region[f]}$("#district_id").replaceWith('<span id="district_id" class="loading">Загрузка списка</span>');$("#subway_id").replaceWith('<span id="subway_id" class="loading">Загрузка списка</span>');$.getJSON("/region/get/"+f,function(g){if(!showErrors(g.errors)&&g.obj!=null){region[f]=g.obj;if(g.data!=null&&g.data.districts!=null){region[f].district_title=g.data.district_title;region[f].districts=g.data.districts}if(g.data!=null&&g.data.subways!=null){region[f].subways=g.data.subways}return b()}})}$(".fmore a, .funmore a").click(function(){var d=$(this).parent();if(d.hasClass("funmore")){d.next("ul").hide("fast");$("a",d).html("больше параметров поиска");d.removeClass().addClass("fmore")}else{d.next("ul").show("fast");$("a",d).html("скрыть параметры поиска");d.removeClass().addClass("funmore")}return false})});